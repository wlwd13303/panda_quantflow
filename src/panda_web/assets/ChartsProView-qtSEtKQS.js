var k=Object.defineProperty;var D=(l,c,u)=>c in l?k(l,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[c]=u;var y=(l,c,u)=>D(l,typeof c!="symbol"?c+"":c,u);import{Q as I}from"./klinecharts-pro-8tx7OSqM.js";import{d as A,r as _,f as $,c as b,o as v,_ as C}from"./main-XMHeTX60.js";const P=A({__name:"ChartsProView",setup(l){const c=_();$(()=>{c.value&&new I({container:c.value,symbol:{exchange:"DCE",market:"stocks",name:"pp2509",shortName:"pp2509",ticker:"pp2509",priceCurrency:"usd",type:"future"},period:{multiplier:15,timespan:"minute",text:"1m"},datafeed:new u("Q0aVaOIdjbaHHu5UZM5MQ0XcOEU3mSIJ")}).setTheme("dark")});class u{constructor(o){y(this,"_apiKey");this._apiKey=o}async searchSymbols(o){try{const t=await fetch("/pandaApi/instrumentInfoData/getQuotation");if(!t.ok)return console.error(`API è¯·æ±‚å¤±è´¥: ${t.status} ${t.statusText}`),[];const s=await t.json();if(console.log("API è¿”å›ç»“æœ:",s),s.code!=="200"||!s.data)return console.error("API è¿”å›é”™è¯¯:",s.message),[];const e=Object.values(s.data);console.log(`è·å–åˆ° ${e.length} ä¸ªåˆçº¦`);let n=e;if(o&&o.trim()){const a=o.toLowerCase();n=e.filter(r=>r.code&&r.code.toLowerCase().includes(a)),console.log(`æœç´¢ "${o}" åŒ¹é…åˆ° ${n.length} ä¸ªåˆçº¦`)}return n.map(a=>({ticker:a.code||"",name:a.underlyingSymbol||a.code||"",shortName:a.code||"",exchange:a.exchange||"",market:"futures",pricePrecision:2,volumePrecision:0,priceCurrency:"CNY",type:"future"}))}catch(t){return console.error("æœç´¢ä»£ç æ—¶å‘ç”Ÿé”™è¯¯:",t),[]}}async getHistoryKLineData(o,t,s,e){return console.log("getHistoryKLineData",o,t,s,e),await((await(await fetch(`/pandaApi/historyData/queryHistoryData?startDate=${s}&endDate=${e}&symbol=${o.ticker}&period=${t.text}&quotationType=future`)).json()).data||[]).map(r=>({timestamp:t.text==="1d"?new Date(r.date.slice(0,4)+"-"+r.date.slice(4,6)+"-"+r.date.slice(6,8)).getTime():new Date(r.date).getTime(),open:r.open,high:r.high,low:r.low,close:r.close,volume:r.volume,turnover:r.volume}))}async getOrderFlowData(o){try{console.log(`ğŸ“¡ è°ƒç”¨PandaAIè®¢å•æµAPI: ${o.ticker}`);const t={symbolCode:o.ticker||"SA509",cycle:1,baseBarCount:1e4};console.log("ğŸ“¤ è¯·æ±‚å‚æ•°:",t);let s=localStorage.getItem("token");s="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1aWQiOiI0In0.m_uYVVkN6saALnHY9OyU6WIVNfLmku0Q_0lCX6DKNfTbezBJUSMqiDtTvXAnxGC1cNpeDKIkSlCh_GcIH3F5MRUbYNwmUCF_ZANYIP0vZbp6CUIOuGR9wiKtsjo5BAv4ecczMf2SsCWyBxOQN0K7h4yhSR6iVpyV5MkM0SLsDGCI0VnwbLFEANjgFGi-Hz_RICd_SIAIQxBtwPgOzeowEgnoKILpFs7xvOao3GDpJqo7GmeLmTzzilpH8udWo74SyEfxYewRodjkPi2VOdlTiWaX1qMv16seX0JKhJsuDk88eEMIJcjg9Y5G29hDzjef2z89Yjjyi_0dxh9Rla_Xsw";const e=await fetch("/pandaApi/orderFlow/getHistoryMarketData",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`${s}`},body:JSON.stringify(t)});if(!e.ok)throw new Error(`APIè¯·æ±‚å¤±è´¥: ${e.status} ${e.statusText}`);const n=await e.json();if(console.log("ğŸ“¥ APIè¿”å›æ•°æ®:",n),n.code!=="200")throw new Error(`APIè¿”å›é”™è¯¯: ${n.code} - ${n.message}`);const a=this.convertPandaApiDataToOrderFlow(n.data,o);return console.log(`âœ… è½¬æ¢å®Œæˆï¼Œå…±${a.length}æ¡è®¢å•æµæ•°æ®`),a}catch(t){return console.error("âŒ è·å–è®¢å•æµæ•°æ®å¤±è´¥:",t),console.warn("ğŸ”„ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºé™çº§æ–¹æ¡ˆ"),this.generateMockOrderFlowData(o)}}convertPandaApiDataToOrderFlow(o,t){if(!o||!o.baseBar||!Array.isArray(o.baseBar))return console.warn("âš ï¸ APIæ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"),this.generateMockOrderFlowData(t);const s=[];for(const e of o.baseBar)try{const n=this.parseTickTime(e.ticktime),a=[],r=e.price||[],p=e.Ask||[],h=e.Bid||[];console.log(`ğŸ“Š å¤„ç†Baræ•°æ®: æ—¶é—´=${e.ticktime}, ä»·æ ¼æ¡£ä½=${r.length}`);for(let i=0;i<r.length;i++){const m=r[i],w=p[i]||0,g=h[i]||0;m&&(w>0||g>0)&&a.push({price:Number(m.toFixed(2)),buyVolume:g,sellVolume:w,totalVolume:g+w})}a.sort((i,m)=>i.price-m.price);const d={timestamp:n,priceLevels:a,tickSize:.5,open:e.open,high:e.high,low:e.low,close:e.close,volume:e.volume,delta:e.delta};s.push(d),console.log(`âœ… è½¬æ¢Baræ•°æ®æˆåŠŸ: ä»·æ ¼æ¡£ä½=${a.length}, Delta=${e.delta}`)}catch(n){console.error("âŒ è½¬æ¢å•ä¸ªBaræ•°æ®å¤±è´¥:",n,e)}return s}parseTickTime(o){try{if(!o)return Date.now();const t=new Date(o);return isNaN(t.getTime())?(console.warn(`âš ï¸ æ— æ³•è§£ææ—¶é—´æ ¼å¼: ${o}ï¼Œä½¿ç”¨å½“å‰æ—¶é—´`),Date.now()):t.getTime()}catch(t){return console.error("âŒ æ—¶é—´è§£æå¤±è´¥:",t,o),Date.now()}}generateMockOrderFlowData(o){console.log(`ğŸ”„ ç”Ÿæˆ ${o.ticker} çš„æ¨¡æ‹Ÿè®¢å•æµæ•°æ®`);const t=[],s=Date.now()-5*24*60*60*1e3;for(let e=100;e>=0;e--){const n=s-e*60*1e3,a=100+Math.random()*20,r=[];for(let p=0;p<10;p++){const h=a+(p-5)*.1,d=Math.floor(Math.random()*1e3),i=Math.floor(Math.random()*1e3);r.push({price:Number(h.toFixed(2)),buyVolume:d,sellVolume:i,totalVolume:d+i})}t.push({timestamp:n,priceLevels:r,tickSize:.01})}return console.log("mockData",t),t}}return(f,o)=>(v(),b("div",{ref_key:"containerRef",ref:c,id:"container",class:"chart-container"},null,512))}}),x=C(P,[["__scopeId","data-v-827a0e9c"]]);export{x as default};
